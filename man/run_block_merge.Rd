% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_block_merge.R
\name{run_block_merge}
\alias{run_block_merge}
\title{Block-wise disease node merging with PAC-selected consensus kmeans}
\usage{
run_block_merge(
  raw_data,
  codebook,
  prevalence_cutoff = 0.001,
  n_resamples = 1000,
  sample_frac = 0.8,
  pac_x1 = 0.1,
  pac_x2 = 0.9,
  pac_no_merge = 0.1,
  homo_q = 0.1,
  homo_tau = 0.9,
  k_max_per_block = 10,
  kmeans_nstart_resample = 5,
  kmeans_nstart_final = 50,
  kmeans_itmax = 100,
  min_valid_frac = 0.5,
  seed = 123,
  write_files = FALSE,
  output_dir = NULL,
  verbose = TRUE
)
}
\arguments{
\item{raw_data}{data.table/data.frame with columns eid, Category_No}

\item{codebook}{data.table/data.frame with columns No, Frequency, Codes, Names, block}

\item{prevalence_cutoff}{numeric, e.g. 0.001 for 0.1\%}

\item{n_resamples}{integer number of resamples}

\item{sample_frac}{numeric fraction of patients per resample}

\item{pac_x1, pac_x2}{numeric PAC interval bounds}

\item{pac_no_merge}{numeric if min PAC among K>=2 > this, set K*=1}

\item{homo_q, homo_tau}{numeric homogeneity gate for allowing full-block merge (K=1)}

\item{k_max_per_block}{integer maximum K considered per block}

\item{kmeans_nstart_resample, kmeans_nstart_final, kmeans_itmax}{integers}

\item{min_valid_frac}{numeric minimal valid fraction for each (block,K)}

\item{seed}{integer random seed}

\item{write_files}{logical whether to write CSV outputs}

\item{output_dir}{character output directory when write_files=TRUE}

\item{verbose}{logical}
}
\value{
An object of class \code{icdmerge_result}
}
\description{
Build global structural profiles for diseases, perform block-wise consensus k-means clustering
under bootstrap resampling, select K using PAC, and optionally allow full-block merge (K=1)
when K=2 consensus is nearly uniform.
}
