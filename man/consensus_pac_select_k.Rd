% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/consensus_pac_select_k.R
\name{consensus_pac_select_k}
\alias{consensus_pac_select_k}
\title{Consensus clustering + PAC selection within blocks}
\usage{
consensus_pac_select_k(
  M_full,
  fixed_nodes,
  block_map_dt,
  lineage_dt,
  n_resamples,
  sample_frac,
  pac_x1,
  pac_x2,
  pac_no_merge,
  homo_q,
  homo_tau,
  k_max_per_block,
  kmeans_nstart_resample,
  kmeans_nstart_final,
  kmeans_itmax,
  min_valid_frac,
  seed = 123,
  verbose = TRUE
)
}
\arguments{
\item{M_full}{Sparse patient × disease matrix.}

\item{fixed_nodes}{Character vector of disease ids in column order of M_full.}

\item{block_map_dt}{data.table with columns Category_No, col_idx, Block.}

\item{lineage_dt}{data.table used only for consistency (not required in current computation).}

\item{n_resamples}{integer number of resamples.}

\item{sample_frac}{numeric sample fraction of patients per resample.}

\item{pac_x1, pac_x2}{numeric PAC interval bounds.}

\item{pac_no_merge}{numeric: if min PAC among K>=2 is above this, set K*=1.}

\item{homo_q, homo_tau}{numeric: full-block merge gate based on K=2 consensus quantile.}

\item{k_max_per_block}{integer maximum K considered per block.}

\item{kmeans_nstart_resample, kmeans_nstart_final, kmeans_itmax}{kmeans controls.}

\item{min_valid_frac}{minimal fraction of resamples that must be valid for a given (block,K).}

\item{seed}{integer.}

\item{verbose}{logical.}
}
\value{
list with pac_curves, kstar, membership, final_membership_list
}
\description{
For each resample, compute global structural profiles for diseases (block rows × all diseases columns),
run kmeans for each candidate K within block, accumulate co-clustering counts, compute consensus probability,
then select K by PAC. Additionally, allow full-block merge (K=1) when K=2 consensus is nearly uniform.
}
\keyword{internal}
